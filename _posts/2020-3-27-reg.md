---
title: 让我们实现编程语言吧（三）正则文法与实现正则表达式解析引擎
author: ayanamists
date: 2020-3-27
---

## 什么是正则文法

正则文法是比较靠谱的文法。它在CFG的基础上继续进行限制：

每一个正则文法的规则只能是以下两个规则之一：

+ 形如$$A \rightarrow a$$的规则。
+ 形如$$A \rightarrow aB$$的规则。

可以看到这文法是很简单的，过于简单会引起不好用，所以我们也有“增强版”的正则文法，它多了一条规则：

+ 如果$$A, B, C...$$是正则文法左端的符号，那么$$X = ABC...$$也是正则文法。

这个“增强”实际上是允许正则文法进行连接，我们在后面会看到，它和原来的正则文法是完全等价的。

## 正则文法对应的自动机

自动机的使用是比较广泛的，我们在数字电路和网络协议中都看到过它的身影。在这里，我们使用的是“有限状态自动机”，它简单地说就是一张表或者一幅有向图，这张表或者这幅图记录着状态如何变化（以及什么是起始状态，什么是终止状态等等）。那么，它和正则文法是怎么联系起来的呢？

先不讨论“增强”型的正则文法，只讨论一般的正则文法。一个非常关键的想法是：**把非终结符当作一种“状态”**

这样抽象地说可能有点难以理解，我们来说一个具体的文法：

$$ S \rightarrow aA $$

$$ A \rightarrow bB $$

$$ B \rightarrow cC $$

$$ C \rightarrow d $$

很容易可以看出来，这定义的是$$abcd$$这个字符串。

我们可以构想，有这样的一台机器，它输入一个字符串，输出一个布尔值，也就是说，如果这个字符串是“abcd”，那就输出真，否则输出假。

使用“把非终结符当作一种状态”的思想，可以让我们制造出来这种机器。

这机器的开始状态是$$S$$，然后读入一个字符，如果为"a"，就进入$$A$$状态，在$$A$$状态，也读入一个字符，如果为"b"，就进入$$B$$状态，直至在$$C$$状态读入"d"后进入成功状态。

用图片来表示，就是这样：

![1](https://pic.downk.cc/item/5e7e12a4504f4bcb0492dd16.png)

（由于是自动生成的，符号可能不太一样）

如果没能执行刚才的操作，这机器就进入“失败”状态。这就解决了我们的判断问题。

你可能会问，这究竟有什么用呢？不就是匹配个字符串吗，需要这么麻烦？

我们经常研究一个问题“如何组合简单的东西来完成复杂的任务”。一个经久不衰的答案是“封闭性”。而正则文法和自动机恰恰是封闭的。

什么意思呢？如果你把一个非终结符和其对应的自动机看作一种“运算单元”，你就会发现，一个或多个“运算单元”可以通过以下的运算生成另一个更复杂的运算单元：

1. $$ A = aB $$ 将一个终结符和一个非终结符连接，会生成一个可以匹配更长语言的非终结符
2. $$ A = BC $$ 把两个终结符连接起来，会生成一个匹配更长语言的非终结符
3. $$ A = B \| C $$ 将一个终结符和一个终结符用 “|” 连接， 可以生成一个匹配它们两个所对应的语言的终结符

另外的几个操作暂时不引入了，我们需要思考的是，刚才我们说**把非终结符当作一种“状态**，而这里，我们实际上做的是**把非终结符当作一个状态机**。
