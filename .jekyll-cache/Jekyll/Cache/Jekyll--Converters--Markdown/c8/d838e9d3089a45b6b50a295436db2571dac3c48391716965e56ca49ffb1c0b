I"ª<p>æœ€è¿‘å­¦ä¹ socketç¼–ç¨‹ï¼Œé¦–å…ˆé‡åˆ°çš„å°±æ˜¯getaddrinfo()è¿™ä¸ªå‡½æ•°ã€‚æŸäº›æ•™ç¨‹ä¸Šå°†å®ƒçš„ä½œç”¨ç§°ä¸ºâ€œ å®ƒå¸®ä½ è®¾å®šä¹‹å¾Œéœ€è¦çš„ structâ€ ã€‚å…¶å®è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºäº†ä¸‹é¢çš„å·¥ä½œåšå‡†å¤‡ã€‚è¿™ä¸ªå‡½æ•°æ ¹æ®å·²æœ‰çš„ä¿¡æ¯è®¾å®šäº†äº† addrinfo è¿™ä¸ªç»“æ„ä½“ã€‚å®ƒåšçš„ä¸»è¦å·¥ä½œæ˜¯ï¼šè¿›è¡ŒDNSæŸ¥è¯¢ï¼Œå°†ä¸»æœºåè§£æä¸ºipåœ°å€ï¼ˆè¿™éœ€è¦è”ç½‘ï¼‰ï¼Œå¹¶å°†å…¶ä»–ä¿¡æ¯ä¸€å¹¶å¡«å…¥addrinfoç»“æ„ä½“ã€‚</p>

<p>å…ˆçœ‹çœ‹å£°æ˜ï¼š</p>

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">extern int getaddrinfo (const char *__restrict __name,
            const char *__restrict __service,
            const struct addrinfo *__restrict __req,
            struct addrinfo **__restrict __pai);</pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æœåŠ¡åï¼ˆç«¯å£åï¼‰ã€‚ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå‚æ•°å¾ˆå¥‡æ€ªï¼Œä¸€ä¸ªæ˜¯addrinfo* ç±»å‹ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯addrinfo** ç±»å‹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>è¿™å°±è¦è¯´èµ·è¿™ä¸ªå‡½æ•°çš„ç»“æœå¦‚ä½•è®°å½•çš„é—®é¢˜ã€‚addrinfoçš„å£°æ˜å¦‚ä¸‹ï¼š</p>

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">struct addrinfo
{
  int ai_flags;            
  int ai_family;        
  int ai_socktype;       
  int ai_protocol;        
  socklen_t ai_addrlen;       
  struct sockaddr *ai_addr;    
  char *ai_canonname;       
  struct addrinfo *ai_next;    
};</pre>

<p>æ³¨æ„åˆ°æœ€åçš„ä¸€ä¸ªæˆå‘˜ai_nextï¼Œè¿™ä¼¼ä¹æ˜¯è¢«è®¾è®¡æ¥ä¸²æˆé“¾è¡¨çš„ã€‚å®é™…ä¸Šä¹Ÿç¡®å®æ˜¯è¿™æ ·ã€‚ç”±äºä¸€ä¸ªä¸»æœºåå¯èƒ½å¯¹åº”ç€ä¸åŒçš„åœ°å€ï¼ˆæœ€ç®€å•çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªipv4åœ°å€ï¼Œä¸€ä¸ªipv6åœ°å€ï¼‰è¢«å¡«å…¥çš„addrinfo ç»“æ„çš„æ•°é‡æ˜¯ä¸ç¡®å®šçš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼Œè®¾è®¡è€…ç”¨ä¸€ä¸ªæŒ‡å‘addrinfo*çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä»¥ä¾¿å°†é“¾è¡¨çš„å¤´æŒ‡é’ˆå†™è°ƒç”¨è€…æä¾›çš„åœ°å€ã€‚</p>

<p>è¿™å°±æ˜¯ç¬¬å››ä¸ªå‚æ•°äº†ï¼Œé‚£ä¹ˆç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªå‡½æ•°æŸ¥æ‰¾åˆ°ipåï¼Œä¼šå°†è¿æ¥éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯å¡«å¥½ï¼Œè€Œè¿™â€œæ‰€æœ‰ä¿¡æ¯â€ä¹Ÿæ˜¯éœ€è¦è°ƒç”¨è€…æä¾›çš„ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å‘ä¸€ä¸ªå·²ç»å†™å¥½éƒ¨åˆ†ä¿¡æ¯çš„addrinfoç»“æ„ä½“ï¼Œé€šè¿‡è¿™ä¸ªç»“æ„ä½“ä¸­çš„ä¿¡æ¯å†³å®šç»“æœé“¾è¡¨å¦‚ä½•å¡«å†™ã€‚</p>

<p>é‚£ä¹ˆï¼Œå¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬ä¼šé—®ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥åŒæ—¶è¿›è¡Œipv4 å’Œ ipv6å¡«å†™å—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œå®ƒçœŸæ­£å†™å…¥çš„æ˜¯sockaddrç»“æ„ä½“ã€‚è®¾è®¡è€…ä»¬åˆ›é€ äº†ä¸¤ä¸ªé©¬ç”²ï¼šsockaddr_inå’Œsockaddr_in6ï¼Œåˆ†åˆ«å¯¹åº”ipv4å’Œipv6çš„æƒ…å†µï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦é€šè¿‡è½¬å‹æ‹¿åˆ°å…·ä½“çš„åœ°å€ï¼Œæ¯”å¦‚ï¼Œéœ€è¦ipv4çš„åœ°å€æ—¶ï¼Œæˆ‘ä»¬ç”¨è¿™ç§å†™æ³•ï¼š</p>

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">((struct sockaddr_in *)(p-&gt;ai_addr))-&gt;sin_addr</pre>

<p>/*è¿™é‡Œåæ§½ä¸€ä¸‹ï¼Œè¿™æ ·å®åœ¨æ˜¯ä¸å¤ªæ¼‚äº®*/</p>

<p>å­¦ä¼šäº†è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–ä¸€ä¸ªæŸ¥è¯¢ipåœ°å€çš„å°ç¨‹åºï¼š</p>

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">#include&lt;sys/types.h&gt;
#include&lt;sys/socket.h&gt;
#include&lt;netdb.h&gt;
#include&lt;bits/stdc++.h&gt;
#include&lt;arpa/inet.h&gt;
#include&lt;netinet/in.h&gt;

int main(int argc, char *argv[])
{
    addrinfo hints, *res, *p;
    int ret;
    char ipstr[INET6_ADDRSTRLEN];

    /* if (argc != 2)
    {
        std::cout &lt;&lt; "bad input\n";
        exit(-1);
    }*/

    memset(&amp;hints, 0, sizeof(hints));
    hints.ai_family = AF_UNSPEC;
    hints.ai_socktype = SOCK_STREAM;
    hints.ai_flags = AI_CANONNAME;
    ret = getaddrinfo(argv[1], "80", &amp;hints, &amp;res);

    if (ret)
    {
        fprintf(stderr, "%s", gai_strerror(ret));
        exit(-1);
    }

    for (p = res; p != NULL; p = p-&gt;ai_next)
    {
        if (p-&gt;ai_family == AF_INET)
        {
            inet_ntop(p-&gt;ai_family,
                      &amp;(((struct sockaddr_in *)(p-&gt;ai_addr))-&gt;sin_addr),
                      ipstr, sizeof(ipstr));
            std::cout &lt;&lt; "IPV4: " &lt;&lt; ipstr &lt;&lt; '\n';
        }
        else
        {
            inet_ntop(p-&gt;ai_family,
                      &amp;(((struct sockaddr_in6 *)(p-&gt;ai_addr))-&gt;sin6_addr),
                      ipstr, sizeof(ipstr));
            std::cout &lt;&lt; "IPV6: " &lt;&lt; ipstr &lt;&lt; '\n';
        }
    }

    freeaddrinfo(res);
}</pre>

<p>è¿è¡Œç»“æœï¼š</p>

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ayanamists@ubuntu:~/netLab$ ./b google.com
IPV4: 172.217.27.142
IPV6: 2404:6800:4012::200e
ayanamists@ubuntu:~/netLab$ ./b apple.com
IPV4: 17.172.224.47
IPV4: 17.142.160.59
IPV4: 17.178.96.59
ayanamists@ubuntu:~/netLab$ ./b www.baidu.com
IPV4: 182.61.200.7
IPV4: 182.61.200.6
ayanamists@ubuntu:~/netLab$ ./b chenxi.com
IPV4: 104.250.144.22
ayanamists@ubuntu:~/netLab$ ./b blog.ayanamists.xyz
IPV4: 178.128.88.147
</pre>
:ET